<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GG-Match</title>
</head>
<body>
    <div class="scoreboard">
        <div id="score1"></div>
        <div id="score2"></div>
    </div>
    <div class="game" id="game"></div>
    <script>
        const player1 = localStorage.getItem('player1name'),
              player2 = localStorage.getItem('player2name')
        const twoPlayers = !!player2
        let score1 = parseInt(localStorage.getItem('player1score')) || 0
        let score2 = twoPlayers 
                    ? parseInt(localStorage.getItem('player2score')) || 0
                    : parseInt(localStorage.getItem('botScore')) || 0

        let isHumanTurn = true
        let currentPlayer = 1
        let matchesFound = 0

        const flipSound = new Audio; flipSound.src='/assets/flip.mp3'
        const matchSound = new Audio; matchSound.src='/assets/match.mp3'
        const nomatchSound = new Audio; nomatchSound.src='/assets/nomatch.mp3'

        const score1El = document.getElementById('score1')
        const score2El = document.getElementById('score2')

        function updateScoreboard(){
            score1El.textContent = player1+': '+score1;
            score2El.textContent = (twoPlayers ? player2 : 'Bot')+': '+score2;
            if(twoPlayers){
                if(currentPlayer === 1){
                    score1El.classList.add('active')
                    score2El.classList.remove('active')
                }else{
                    score2El.classList.add('active')
                    score1El.classList.remove('active')
                }
            }else{
                if(isHumanTurn){
                    score1El.classList.add('active')
                    score2El.classList.remove('active')
                }else{
                    score2El.classList.add('active')
                    score1El.classList.remove('active')
                }
            }
        }

        updateScoreboard()

        const emojis=['😀','😁','🤣','😂','😃','😄','😅','😆','😉','😊','😋','😎','😍','😘','🥰']
        const cardsData = [...emojis, ...emojis].sort(() => Math.random() - 0.5)
        const gameEl = document.getElementById('game')
        let firstCard=null,secondCard=null,lock=false

        function createCard(emoji){
            const card = document.createElement('div')
            card.className='card'
            card.dataset.emoji=emoji
            const front = document.createElement('div')
            const back = document.createElement('div')
            front.className='cardFace cardFront'
            back.className='cardFace cardBack'
            front.textContent='?'
            back.textContent=emoji;
            card.appendChild(front)
            card.appendChild(back)
            card.addEventListener('click', onCardClick)
            return card;
        }

        cardsData.forEach(e => gameEl.appendChild(createCard(e)))

        function onCardClick(){
            if(lock || (!twoPlayers && !isHumanTurn)) return;
            if(this.classList.contains('flipped')) return;
            flipCard(this)
            if(!firstCard) {firstCard=this; return}
            secondCard=this
            lock=true
            setTimeout(checkMatch, 500)
        }

        function flipCard(card){
            card.classList.add('flipped')
            flipSound.play()
        }
        function unflipCard(card){
            card.classList.remove('flipped')
            flipSound.play()
        }
        function resetSelection(){firstCard=null;secondCard=null;lock=false}

        function checkMatch(){
            if(firstCard.dataset.emoji === secondCard.dataset.emoji){
                matchSound.play()
                if(twoPlayers){
                    if(currentPlayer === 1){
                        score1++
                    localStorage.setItem('player1score', score1)
                    }else{
                        score2++
                    localStorage.setItem('player2score', score2)
                    }
                }else{
                    if(isHumanTurn){
                        score1++
                    localStorage.setItem('player1score', score1)
                    }else{
                        score2++
                        localStorage.setItem('botScore', score2)
                    }
                }
                updateScoreboard()
                matchesFound++
                firstCard.removeEventListener('click', onCardClick)
                secondCard.removeEventListener('click', onCardClick)
                resetSelection()
                if(document.querySelectorAll('.card.flipped') === cardsData.length){
                    setTimeout(endGame, 1000)
                }
                lock=false
            }else{
                nomatchSound.play()
                setTimeout(() => {
                    unflipCard(firstCard)
                    unflipCard(secondCard)
                    if(!twoPlayers && localStorage.getItem('botDiff') === 'hard'){
                        if(isHumanTurn){}
                    }

                }, 600);
            }
        }

    </script>
</body>
</html>